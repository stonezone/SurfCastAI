# SurfCastAI Configuration Template
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to config.yaml: cp config/config.example.yaml config/config.yaml
# 2. Create .env file with: OPENAI_API_KEY=your-actual-key-here
# 3. IMPORTANT: API keys MUST be in .env only (config file keys no longer supported)
# 4. Adjust other settings as needed
#
# BREAKING CHANGE: As of this version, API keys must come from environment variables
# only for security. Config file api_key field is deprecated and will be ignored.
#
# NOTE: config.yaml should NOT be committed to git (add to .gitignore)

general:
  log_level: INFO
  log_file: logs/surfcastai.log
  output_directory: output
  data_directory: data
  timezone: Pacific/Honolulu
  data_retention_days: 30

openai:
  # Default model - used as fallback if a specialist doesn't have one defined
  # Also used by legacy code paths for backward compatibility
  default_model: gpt-5-nano

  # Specialist-specific model assignments (tiered AI architecture)
  # Each specialist can use a different model based on task complexity:
  #   - gpt-5-nano: Cheapest ($0.05/1M in, $0.40/1M out) - Simple analysis
  #   - gpt-5-mini: Mid-tier ($0.25/1M in, $2.00/1M out) - Complex analysis, vision
  #   - gpt-5: Premium ($1.25/1M in, $10.00/1M out) - High-quality synthesis
  specialist_models:
    buoy_analyst: gpt-5-nano        # Simple buoy data analysis
    pressure_analyst: gpt-5-nano    # Using nano for cost optimization during testing
    senior_forecaster: gpt-5-nano   # Using nano for cost optimization during testing

  # Global OpenAI settings (apply to all models)
  # NOTE: API key must be set via OPENAI_API_KEY environment variable in .env file
  # The api_key field is DEPRECATED and no longer supported for security reasons
  temperature: 0.7
  max_tokens: 4000

data_collection:
  max_concurrent: 10
  timeout: 30
  retry_attempts: 3
  user_agent: "SurfCastAI/1.0 (+https://github.com/yourusername/surfCastAI)"

rate_limits:
  "www.ndbc.noaa.gov":
    requests_per_second: 0.5
    burst_size: 3
  "api.weather.gov":
    requests_per_second: 0.25
    burst_size: 2
  "tgftp.nws.noaa.gov":
    requests_per_second: 0.5
    burst_size: 3
  "api.tidesandcurrents.noaa.gov":
    requests_per_second: 0.2
    burst_size: 2
  "nomads.ncep.noaa.gov":
    requests_per_second: 0.15
    burst_size: 2
  "ocean.weather.gov":
    requests_per_second: 0.1
    burst_size: 1
  "www.nhc.noaa.gov":
    requests_per_second: 0.1
    burst_size: 1
  "marine-api.open-meteo.com":
    requests_per_second: 0.3
    burst_size: 3
  default:
    requests_per_second: 0.2
    burst_size: 2

data_sources:
  buoys:
    enabled: true
    urls:
      # Standard observations (.txt files)
      - "https://www.ndbc.noaa.gov/data/realtime2/51001.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51002.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51003.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51004.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51101.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51201.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51202.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51207.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51211.txt"
      - "https://www.ndbc.noaa.gov/data/realtime2/51212.txt"
      # Spectral data (.spec files) - enables multi-component swell separation
      - "https://www.ndbc.noaa.gov/data/realtime2/51001.spec"
      - "https://www.ndbc.noaa.gov/data/realtime2/51002.spec"
      - "https://www.ndbc.noaa.gov/data/realtime2/51004.spec"
      - "https://www.ndbc.noaa.gov/data/realtime2/51101.spec"
      - "https://www.ndbc.noaa.gov/data/realtime2/51201.spec"
      - "https://www.ndbc.noaa.gov/data/realtime2/51202.spec"
      - "https://www.ndbc.noaa.gov/data/realtime2/51207.spec"
      # Directional spectral data (.swdir files) - wave direction by frequency
      - "https://www.ndbc.noaa.gov/data/realtime2/51004.swdir"
      - "https://www.ndbc.noaa.gov/data/realtime2/51201.swdir"
      - "https://www.ndbc.noaa.gov/data/realtime2/51202.swdir"
      - "https://www.ndbc.noaa.gov/data/realtime2/51207.swdir"
  weather:
    enabled: true
    urls:
      # NWS Forecast Office Honolulu (HFO) grid forecasts
      # Grid coordinates updated (HNL office code deprecated, now HFO)
      - "https://api.weather.gov/gridpoints/HFO/148,158/forecast"  # North Shore area
      - "https://api.weather.gov/gridpoints/HFO/154,145/forecast"  # South Shore (Honolulu)
  metar:
    enabled: true
    urls:
      - "https://tgftp.nws.noaa.gov/data/observations/metar/stations/PHNL.TXT"
      - "https://tgftp.nws.noaa.gov/data/observations/metar/stations/PHJR.TXT"
  tides:
    enabled: true
    urls:
      - "https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?station=1612340&product=water_level&datum=MLLW&units=metric&time_zone=GMT&date=today&format=csv"
      - "https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?station=1612340&product=predictions&datum=MLLW&units=metric&time_zone=GMT&interval=1&range=48&format=csv"
  models:
    enabled: true
    urls:
      # WW3 Multi-Grid OPeNDAP (gridded data, fallback if CSV fails)
      - "https://nomads.ncep.noaa.gov:9090/dods/gfs_0p25"
      - "https://nomads.ncep.noaa.gov:9090/dods/wave_multi_1.glo_0.16"

      # WW3 CSV Point Guidance (Hawaii grid points with template expansion)
      # Template: {date} = YYYYMMDD, {hour} = 00/06/12/18
      # Tries most recent cycle first, falls back to earlier cycles
      - "https://nomads.ncep.noaa.gov/pub/data/nccf/com/wave/prod/multi_1.{date}/points/hawaii/wvprbl_hi.{date}.t{hour}z.csv"
      - "https://ftpprd.ncep.noaa.gov/data/nccf/com/wave/prod/multi_1.{date}/points/hawaii/wvprbl_hi.{date}.t{hour}z.csv"

      # PacIOOS SWAN Oahu regional model (high-resolution nearshore forecasts)
      # NOTE: Currently returning 404, keeping for future restoration
      # - "https://www.pacioos.hawaii.edu/wave-model/swan-oahu/"
  marine_forecasts:
    enabled: true
    urls:
      # Open-Meteo Marine API - Free wave forecasts (no API key required)
      # Provides hourly wave_height, wave_period, wave_direction for 7 days
      - "https://marine-api.open-meteo.com/v1/marine?latitude=21.7&longitude=-158.0&hourly=wave_height,wave_period,wave_direction"  # North Shore
      - "https://marine-api.open-meteo.com/v1/marine?latitude=21.3&longitude=-157.9&hourly=wave_height,wave_period,wave_direction"  # South Shore (Honolulu)
      - "https://marine-api.open-meteo.com/v1/marine?latitude=21.4&longitude=-157.7&hourly=wave_height,wave_period,wave_direction"  # East Shore (Kailua)
      - "https://marine-api.open-meteo.com/v1/marine?latitude=21.5&longitude=-158.2&hourly=wave_height,wave_period,wave_direction"  # West Shore (Waianae)
      - "https://marine-api.open-meteo.com/v1/marine?latitude=21.5&longitude=-157.95&hourly=wave_height,wave_period,wave_direction"  # Central Oahu
      - "https://marine-api.open-meteo.com/v1/marine?latitude=21.0&longitude=-158.5&hourly=wave_height,wave_period,wave_direction"  # Offshore West
  satellite:
    enabled: true
    urls:
      - "https://www.star.nesdis.noaa.gov/goes/sector.php?sat=G17&sector=hin&length=24&img=geocolor"
  charts:
    enabled: true
    urls:
      # Surface pressure analysis and forecasts
      - "https://www.weather.gov/images/hfo/graphics/npac.gif"           # OPC North Pacific surface analysis (0 hr)
      - "https://tgftp.nws.noaa.gov/fax/PJBA99.gif"                      # OPC 24 hr surface forecast (fax graphic)
      - "https://tgftp.nws.noaa.gov/fax/PWFE11.gif"                      # OPC 48 hr surface forecast (fax graphic)
      - "https://ocean.weather.gov/P_sfc_24hr_ocean_color.png"           # 24hr surface pressure
      - "https://ocean.weather.gov/P_sfc_48hr_ocean_color.png"           # 48hr surface pressure
      - "https://ocean.weather.gov/P_sfc_96hr_ocean_color.png"           # 96hr surface pressure
      - "https://ocean.weather.gov/P_sfc_120hr_ocean_color.png"          # 120hr surface pressure
      # Wave period analysis and forecasts - critical for swell timing
      - "https://ocean.weather.gov/shtml/P_024hrwper_thumb.gif"          # 24hr wave period forecast
      - "https://ocean.weather.gov/shtml/P_048hrwper_color.gif"          # 48hr wave period forecast
      - "https://ocean.weather.gov/shtml/P_072hrwper_thumb.gif"          # 72hr wave period forecast
      - "https://ocean.weather.gov/shtml/P_096hrwper_color.gif"          # 96hr wave period forecast
      # Sea-state (wave height) analysis and forecasts
      - "https://ocean.weather.gov/shtml/P_00hrww.gif"                   # Current sea-state analysis
      - "https://ocean.weather.gov/shtml/P_48hrww.gif"                   # 48hr wind/wave forecast
      - "https://ocean.weather.gov/shtml/P_96hrww.gif"                   # 96hr wind/wave forecast
      # Surface wind analysis - for fetch and local wind wave generation
      - "https://ocean.weather.gov/P_w_sfc_color.png"                    # Surface wind analysis
  altimetry:
    enabled: true
    urls:
      # NOTE: Legacy JASON/Sentinel SSH imagery (STAR, OSPO) deprecated/unavailable
      # Using ERDDAP SST data as proxy for ocean state analysis
      # SST patterns correlate with currents and can indicate swell propagation conditions

      # CoastWatch ERDDAP - Multi-scale SST (Hawaii region)
      - "https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41.graph?analysed_sst[(last)][(19.0):(23.0)][(-161.0):(-154.0)]&.draw=surface&.vars=longitude|latitude|analysed_sst&.colorBar=Rainbow2|||||&.land=under"

      # Upwell ERDDAP - SST anomaly (Pacific basin for long-period swell context)
      - "https://upwell.pfeg.noaa.gov/erddap/griddap/jplMURSST41mday.graph?sst[(last)][(15.0):(30.0)][(-170.0):(-150.0)]&.draw=surface&.vars=longitude|latitude|sst&.colorBar=Rainbow|||||&.land=under"
  nearshore_buoys:
    enabled: true
    sources:
      # CDIP Station 106 - Kaumalapau, Lanai (nearshore directional spectra)
      - id: "106"
        url: "https://thredds.cdip.ucsd.edu/thredds/dodsC/cdip/archive/106p1/106p1_historic.nc"
        format: "cdip_netcdf"
        description: "CDIP 106 Kaumalapau - Directional wave spectra"
        ndbc_fallback: "https://www.ndbc.noaa.gov/data/realtime2/51212.txt"

      # CDIP Station 225 - Ewa Beach (nearshore directional spectra)
      - id: "225"
        url: "https://thredds.cdip.ucsd.edu/thredds/dodsC/cdip/realtime/225p1_rt.nc"
        format: "cdip_netcdf"
        description: "CDIP 225 Ewa Beach - Directional wave spectra for south shore translation"
        ndbc_fallback: "https://www.ndbc.noaa.gov/data/realtime2/51202.txt"

      # CDIP Station 239 - Waimea Bay (nearshore directional spectra)
      - id: "239"
        url: "https://thredds.cdip.ucsd.edu/thredds/dodsC/cdip/realtime/239p1_rt.nc"
        format: "cdip_netcdf"
        description: "CDIP 239 Waimea Bay - Critical for North Shore surf translation"
        ndbc_fallback: "https://www.ndbc.noaa.gov/data/realtime2/51201.txt"

      # CDIP Station 249 - Hanalei, Kauai (nearshore directional spectra)
      - id: "249"
        url: "https://thredds.cdip.ucsd.edu/thredds/dodsC/cdip/realtime/249p1_rt.nc"
        format: "cdip_netcdf"
        description: "CDIP 249 Hanalei - Nearshore validation for Kauai"
        ndbc_fallback: "https://www.ndbc.noaa.gov/data/realtime2/51207.txt"
  upper_air:
    enabled: true
    sources:
      # SPC Upper-Air Analysis (objectively analyzed maps)
      # Template: {date} = YYMMDD_HH format (e.g., 251123_00)
      # SPC publishes maps at 00Z and 12Z synoptic times
      - id: "spc_250mb"
        url: "https://www.spc.noaa.gov/obswx/maps/250_{date}.gif"
        level: "250mb"
        product_type: "jet_stream"
        description: "SPC 250mb analysis - jet stream position"
        date_format: "%y%m%d_%H"

      - id: "spc_500mb"
        url: "https://www.spc.noaa.gov/obswx/maps/500_{date}.gif"
        level: "500mb"
        product_type: "upper_low"
        description: "SPC 500mb analysis - upper-level lows and ridges"
        date_format: "%y%m%d_%H"

      # UCAR/RAL Real-Time Upper Air (backup)
      # These require query parameters, keeping for future enhancement
      # - id: "ucar_250mb"
      #   url: "https://weather.ral.ucar.edu/upper/displayUpper.php?img=upaCNTR_250.gif"
      #   level: "250mb"
      #   description: "UCAR 250mb contour analysis"
  tropical:
    enabled: true
    urls:
      - "https://www.nhc.noaa.gov/xml/TWOCP.xml"

processing:
  buoy:
    min_confidence: 0.7
    anomaly_threshold: 3.0
  weather:
    min_confidence: 0.6
  model:
    min_confidence: 0.7
    swell_detection:
      min_height: 0.5
      min_period: 8.0
      min_significance: 0.4
  fusion:
    weight_buoy: 0.7
    weight_model: 0.6
    weight_weather: 0.5
    min_combined_confidence: 0.6

forecast:
  templates_dir: config/prompts/v1
  refinement_cycles: 2
  quality_threshold: 0.8
  use_local_generator: true
  use_specialist_team: true   # Multi-agent architecture enabled
  formats: markdown,html
  max_images: 10              # GPT-5 limit (can reduce to 6-8 for cost)
  token_budget: 150000        # Conservative for gpt-5-mini
  warn_threshold: 200000      # GPT-5 context limit
  enable_budget_enforcement: true
  image_detail_levels:
    pressure_charts: high     # 3000 tokens each (critical)
    wave_models: auto         # 1500 tokens each (important)
    satellite: auto           # 1500 tokens each (validation)
    sst_charts: low           # 500 tokens (context only)
